---
title: "Project Update 3"
author: "Meng Synn & Maya Mileva & Stefano Selenu"
date: March, 14, 2019
output:
  word_document: default
  pdf_document: default
---

#IST 687 Applied Data Science
#Mohammed Syed

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=FALSE, echo=FALSE}
#install.packages and libraries
#install.packages("RCurl")
#library("RCurl")
#install.packages("RJSONIO")
#install.packages("sqldf")
#install.packages("ggplot2")
#install.packages("ggmap")
library("RJSONIO")
library(sqldf)
library(stringr)
library(ggplot2)
library(ggmap)
require(gridExtra)
require(lattice)
library(gdata)
library(kernlab)
library(reshape2)
```

# 1 Introduction

# 2 Problem Definition, Business Questions, and Methodology

# 3 Data Acquisition, Munging, and Classification
## 3.1 Data Acquisition

```{r}
# Create dataframe from .csv file
# Meng
#dfUSEducation <- read.csv("C:/Learning/ProjectDataset/USEducationDataset/states_all_extended.csv",stringsAsFactors = FALSE)
# Stefano
#dfUSEducation <- read.csv("H:/states_all_extended.csv",
                        # stringsAsFactors = FALSE)
# Maya
dfUSEducation <- read.csv("C:/Users/aivii/OneDrive/Desktop/SCHOOL/IST687/STAFF FOR IST 687/states_all_extended.csv",stringsAsFactors = FALSE)

```

## 3.2 Data cleaning and munging
```{r}
# Create dataset for the lower 48 states for filtering purposes for other dataset 
dfUSStates <- data.frame(tolower(state.name))
colnames(dfUSStates) <- c("StateName")
dfUSStates <- data.frame(dfUSStates[dfUSStates$StateName != "hawaii" & dfUSStates$StateName != "alaska",])
colnames(dfUSStates) <- c("StateName")
# Replace NAs with 0s
dfUSEducation[is.na(dfUSEducation)] <- 0

```


```{r}
# Remove PRIMARY_KEY column
dfUSEducation <- dfUSEducation[,-1]
# Remove "_" from STATE
dfUSEducation$STATE <- str_replace_all(dfUSEducation$STATE, '_', ' ')

# Make sure state name is in lowercase
dfUSEducation$STATE <- tolower(dfUSEducation$STATE)

# Get 9 years of good data for the lower 48 states from 1996 to 2015

dfUSEducation_ALL <- sqldf("SELECT * FROM dfUSEducation sa JOIN dfUSStates s
                      ON sa.STATE = s.StateName")

# 1996,2000,2003,2005,2007 do not contain full spectrum of races and genders 
dfUSEducation <- sqldf("SELECT * FROM dfUSEducation sa JOIN dfUSStates s
                      ON sa.STATE = s.StateName
                      AND sa.YEAR IN (2009,2011,2013,2015)")


```
# 3.3 Data Classification: a Short Summary

# 4 Descriptive Statistics

## 4.1 Data Structure
```{r}
# Create a function to return specific dataset
SelectDataByYear <- function(sql, year)
{
  strSQL <- sql
  if (year > 0)
  {
    strSQL <- paste(sql, "WHERE YEAR = ", year)
  }
  
  df <- sqldf(strSQL)
  return (df)
}
```

```{r}
# Selecting only fields needed and for the years in (2009,2011,2013,2015)
Retention <- "SELECT STATE,YEAR,TOTAL_REVENUE,TOTAL_EXPENDITURE,
          INSTRUCTION_EXPENDITURE,GRADES_ALL_G ALL_STUDENT_ALL,
          GRADES_8_G ALL_STUDENT_8,AVG_MATH_8_SCORE,
          AVG_READING_8_SCORE,GRADES_9_12_G ALL_STUDENT_9_12,
          GRADES_12_G ALL_STUDENT_12,
          (AVG_MATH_8_SCORE + AVG_READING_8_SCORE)/2 SCORE,
          (GRADES_8_G - GRADES_12_G) DROP_OUT_8_12 ,
          (((GRADES_9_12_G - GRADES_12_G)/3) - GRADES_12_G) HS_DROP_OUT
          FROM dfUSEducation"
# Selecting fields needed from the entire dataset
Retention_ALL <- "SELECT STATE,YEAR,TOTAL_REVENUE,TOTAL_EXPENDITURE,
          INSTRUCTION_EXPENDITURE,GRADES_ALL_G ALL_STUDENT_ALL,
          GRADES_8_G ALL_STUDENT_8,AVG_MATH_8_SCORE,AVG_READING_8_SCORE,
          GRADES_9_12_G ALL_STUDENT_9_12,GRADES_12_G ALL_STUDENT_12,
          (GRADES_8_G - GRADES_12_G) DROP_OUT_8_12,
          (GRADES_9_12_G - GRADES_12_G) HS_DROP_OUT 
          FROM dfUSEducation_ALL"
```
```{r}
# Create dataset for retention
dfRetention <- SelectDataByYear(Retention, 0)
# Create dataset for all years. the dataset is needed for creating train and test datasets.
dfRetention_ALL <- SelectDataByYear(Retention_ALL, 0)
```

## 4.2 EDA with Maps and Charts
```{r, echo = FALSE}
us <- map_data("state")
# Store state name into a variable
dfStates <- data.frame(state.name, stringsAsFactors=FALSE)
```

```{r, echo = FALSE}
# Plot basic U.S. map using state dataframe
map.Revenue <- ggplot(dfUSEducation, aes(map_id = STATE)) +
        geom_map(map = us, aes(fill=dfUSEducation$TOTAL_REVENUE), color="white") +
        expand_limits(x = us$long, y = us$lat) +
        coord_map() +
        scale_fill_continuous(low = "blue", high = "red", name = "Total Revenue", label = scales::comma) +
        theme(legend.position = "right") +
        ggtitle("Total Revenue per State") +
        labs(x= "Longitude") +
        labs(y= "Latitude")
```

```{r, echo = FALSE}
# Plot basic U.S. map using state dataframe
map.Expenditure <- ggplot(dfUSEducation, aes(map_id = STATE)) +
        geom_map(map = us, aes(fill=dfUSEducation$TOTAL_EXPENDITURE), color="White") +
        expand_limits(x = us$long, y = us$lat) +
        coord_map() +
        scale_fill_continuous(low = "blue", high = "red", name = "Total Expenditure", label = scales::comma) +
        theme(legend.position = "right") +
        ggtitle("Total Expenditure per State") +
        labs(x= "Longitude") +
        labs(y= "Latitude")
```

```{r, echo = FALSE}
# Plot basic U.S. map using state dataframe
map.Primary <- ggplot(dfUSEducation, aes(map_id = STATE)) +
        geom_map(map = us, aes(fill=dfUSEducation$GRADES_1_8_G), color="white") +
        expand_limits(x = us$long, y = us$lat) +
        coord_map() +
        scale_fill_continuous(low = "gray", high = "blue", name = "Student Population", label = scales::comma) +
        theme(legend.position = "right") +
        ggtitle("Primary School Population per State") +
        labs(x= "Longitude") +
        labs(y= "Latitude")
```

```{r, echo = FALSE}
# Plot basic U.S. map using state dataframe
map.HighSchool <- ggplot(dfUSEducation, aes(map_id = STATE)) +
        geom_map(map = us, aes(fill=dfUSEducation$GRADES_9_12_G), color="White") +
        expand_limits(x = us$long, y = us$lat) +
        coord_map() +
        scale_fill_continuous(low = "gray", high = "blue", name = "Student Population", label = scales::comma) +
        theme(legend.position = "right") +
        ggtitle("High School Population per State") +
        labs(x= "Longitude") +
        labs(y= "Latitude")
```

```{r, echo = FALSE}
# Plot basic U.S. map using state dataframe
map.Math8Score <- ggplot(dfUSEducation, aes(map_id = STATE)) +
        geom_map(map = us, aes(fill=dfUSEducation$AVG_MATH_8_SCORE), color="White") +
        expand_limits(x = us$long, y = us$lat) +
        coord_map() +
        scale_fill_continuous(low = "white", high = "darkgreen", name = "Math Score", label = scales::comma) +
        theme(legend.position = "right") +
        ggtitle("Eight Grade Math Score") +
        labs(x= "Longitude") +
        labs(y= "Latitude")
```

```{r, echo = FALSE}
# Plot basic U.S. map using state dataframe
map.Reading8Score <- ggplot(dfUSEducation, aes(map_id = STATE)) +
        geom_map(map = us, aes(fill=dfUSEducation$AVG_READING_8_SCORE), color="White") +
        expand_limits(x = us$long, y = us$lat) +
        coord_map() +
        scale_fill_continuous(low = "white", high = "darkgreen", name = "Reading Score", label = scales::comma) +
        theme(legend.position = "right") +
        ggtitle("Eight Grade Reading Score") +
        labs(x= "Longitude") +
        labs(y= "Latitude")
```

```{r, echo = FALSE}
# Plot basic U.S. map using state dataframe
map.HS_DROP_OUT <- ggplot(dfRetention, aes(map_id = STATE)) +
        geom_map(map = us, aes(fill=dfRetention$HS_DROP_OUT), color="White") +
        expand_limits(x = us$long, y = us$lat) +
        coord_map() +
        scale_fill_continuous(low = "lightblue", high = "purple", name = "Total", label = scales::comma) +
        theme(legend.position = "right") +
        ggtitle("High School Dropout") +
        labs(x= "Longitude") +
        labs(y= "Latitude")

```

```{r, echo = FALSE}
# Plot basic U.S. map using state dataframe
map.HS_DROP_OUT_8_12 <- ggplot(dfRetention, aes(map_id = STATE)) +
        geom_map(map = us, aes(fill=dfRetention$DROP_OUT_8_12), color="White") +
        expand_limits(x = us$long, y = us$lat) +
        coord_map() +
        scale_fill_continuous(low = "lightblue", high = "purple", name = "Total", label = scales::comma) +
        theme(legend.position = "right") +
        ggtitle("8th-12th Dropout") +
        labs(x= "Longitude") +
        labs(y= "Latitude")

```

```{r}
#INSTRUCTION EXPENDITURE for the last four years available
#2009
Instruction_expenditure2009 <- sqldf("SELECT STATE, YEAR, INSTRUCTION_EXPENDITURE
          FROM dfUSEducation WHERE YEAR = 2009")

map.Instruction_expenditure2009 <- ggplot(Instruction_expenditure2009, aes(map_id = STATE)) +
        geom_map(map = us, aes(fill=Instruction_expenditure2009$INSTRUCTION_EXPENDITURE), color="White") +
        expand_limits(x = us$long, y = us$lat) +
        coord_map() +
        scale_fill_continuous(low = "lightgrey", high = "red", name = "Total", label = scales::comma) +
        theme(legend.position = "right") +
        ggtitle("Instruction expenditure 2009") +
        labs(x= "Longitude") +
        labs(y= "Latitude")

```

```{r}
#2011
Instruction_expenditure2011 <- sqldf("SELECT STATE, YEAR, INSTRUCTION_EXPENDITURE
          FROM dfUSEducation WHERE YEAR = 2011")

map.Instruction_expenditure2011 <- ggplot(Instruction_expenditure2011, aes(map_id = STATE)) +
        geom_map(map = us, aes(fill=Instruction_expenditure2011$INSTRUCTION_EXPENDITURE), color="White") +
        expand_limits(x = us$long, y = us$lat) +
        coord_map() +
        scale_fill_continuous(low = "lightgrey", high = "red", name = "Total", label = scales::comma) +
        theme(legend.position = "right") +
        ggtitle("Instruction expenditure 2011") +
        labs(x= "Longitude") +
        labs(y= "Latitude")
```

```{r}
#2013
Instruction_expenditure2013 <- sqldf("SELECT STATE, YEAR, INSTRUCTION_EXPENDITURE
          FROM dfUSEducation WHERE YEAR = 2013")

map.Instruction_expenditure2013 <- ggplot(Instruction_expenditure2013, aes(map_id = STATE)) +
        geom_map(map = us, aes(fill=Instruction_expenditure2013$INSTRUCTION_EXPENDITURE), color="White") +
        expand_limits(x = us$long, y = us$lat) +
        coord_map() +
        scale_fill_continuous(low = "lightgrey", high = "red", name = "Total", label = scales::comma) +
        theme(legend.position = "right") +
        ggtitle("Instruction expenditure 2013") +
        labs(x= "Longitude") +
        labs(y= "Latitude")
```

```{r}

#2015
Instruction_expenditure2015 <- sqldf("SELECT STATE, YEAR, INSTRUCTION_EXPENDITURE
          FROM dfUSEducation WHERE YEAR = 2015")

map.Instruction_expenditure2015 <- ggplot(Instruction_expenditure2015, aes(map_id = STATE)) +
        geom_map(map = us, aes(fill=Instruction_expenditure2015$INSTRUCTION_EXPENDITURE), color="White") +
        expand_limits(x = us$long, y = us$lat) +
        coord_map() +
        scale_fill_continuous(low = "lightgrey", high = "red", name = "Total", label = scales::comma) +
        theme(legend.position = "right") +
        ggtitle("Instruction expenditure 2015") +
        labs(x= "Longitude") +
        labs(y= "Latitude")

```

```{r}
grid.arrange(map.Instruction_expenditure2009, map.Instruction_expenditure2011, map.Instruction_expenditure2013,map.Instruction_expenditure2015)
```

```{r}
grid.arrange(map.Instruction_expenditure2009, map.Instruction_expenditure2011)
```

```{r}
grid.arrange(map.Instruction_expenditure2013,map.Instruction_expenditure2015)
```
```{r}
#grid.arrange(map.Instruction_expenditure2013,map.Instruction_expenditure2015)
grid.arrange(map.Instruction_expenditure2009,map.Instruction_expenditure2015)
```

```{r}
# Arrange the plots via grid.arrange 
grid.arrange(map.HS_DROP_OUT_8_12,map.HS_DROP_OUT)
```


```{r}
# Arrange the plots via grid.arrange 
grid.arrange(map.Revenue, map.Expenditure, ncol=1)
```

```{r}
# Arrange the plots via grid.arrange 
grid.arrange(map.Primary, map.HighSchool)
```

```{r}
# Arrange the plots via grid.arrange 
grid.arrange(map.Math8Score, map.Reading8Score)
```

## 4.3 Reshaping the Data

```{r}
# Calculate average math and reading score for states
avg.Score_8 <- sqldf("SELECT STATE, AVG(AVG_MATH_8_SCORE) AVG_MATH_8_SCORE, 
              AVG(AVG_READING_8_SCORE) AVG_READING_8_SCORE 
              FROM dfUSEducation GROUP BY STATE")
```
```{r}
head(avg.Score_8)
```
\newpage


```{r}
# Calculating min average reading score
dfMinAVG_READING_8_SCORE <- sqldf('select STATE, min(AVG_READING_8_SCORE) READ_8 
            FROM dfRetention GROUP BY STATE  order by min(AVG_READING_8_SCORE)')
head(dfMinAVG_READING_8_SCORE)
# Calculating min average math score
dfMinAVG_MATH_8_SCORE <- sqldf('select STATE, min(AVG_MATH_8_SCORE) MATH_8 
            FROM dfRetention GROUP BY STATE  order by min(AVG_MATH_8_SCORE)')
head(dfMinAVG_MATH_8_SCORE)
```
```{r}
# Calculating max average reading score
dfMaxAVG_READING_8_SCORE <- sqldf('select STATE, max(AVG_READING_8_SCORE) READ_8 
              FROM dfRetention GROUP BY STATE  order by max(AVG_READING_8_SCORE)  desc')
head(dfMaxAVG_READING_8_SCORE)
# Calculating max average math score
dfMaxAVG_MATH_8_SCORE <- sqldf('select STATE, max(AVG_MATH_8_SCORE) MATH_8 
              FROM dfRetention GROUP BY STATE  order by max(AVG_MATH_8_SCORE)  desc')
head(dfMaxAVG_MATH_8_SCORE )

```
```{r}
# Finding out the state with min value
minState <- dfRetention[which.min((dfRetention$AVG_READING_8_SCORE  + dfRetention$AVG_MATH_8_SCORE)/2),]
# Finding out the state with max value
maxState <- dfRetention[which.max((dfRetention$AVG_READING_8_SCORE  + dfRetention$AVG_MATH_8_SCORE)/2),]
# Create matrix for 8th grade
print(minState)
print(maxState)
```


```{r}
# Look at relationship between total exp, instruction exp, and the population in relation to scores for both New YOrk and Mass. to start with.

dfGrades_8NewYork <- dfRetention[dfRetention$STATE == "new york",]
dfGrades_8Massachusetts <-  dfRetention[dfRetention$STATE == "massachusetts",]
dfGrades_8Florida <-  dfRetention[dfRetention$STATE == "florida",]

```

```{r}
# Create datasets for retention by year
dfRetention_2009 <- SelectDataByYear(Retention, 2009)
dfRetention_2011 <- SelectDataByYear(Retention, 2011)
dfRetention_2013 <- SelectDataByYear(Retention, 2013)
dfRetention_2015 <- SelectDataByYear(Retention, 2015)
```

```{r}
# Finding which state has the minimum total expenditure
dfRetention[which.min(dfRetention$TOTAL_EXPENDITURE),]
```

```{r}
# Finding which state has the maximum total expenditure
dfRetention[which.max(dfRetention$TOTAL_EXPENDITURE),]
```
```{r}
dfRetention[which.max(dfRetention_2015$DROP_OUT_8_12),]
dfRetention[which.max(dfRetention_2015$HS_DROP_OUT),]
```
```{r}
dfRetention[which.min(dfRetention_2015$DROP_OUT_8_12),]
dfRetention[which.min(dfRetention_2015$HS_DROP_OUT),]
```

## 4.4  Box Plots and Histograms

```{r}
# Prepare datasets for charting
dfRetention.NY <- sqldf('SELECT YEAR, DROP_OUT_8_12, HS_DROP_OUT 
                      FROM dfRetention WHERE STATE ="new york"')
dfRetention.MA <- sqldf('SELECT YEAR, DROP_OUT_8_12, HS_DROP_OUT 
                  FROM dfRetention WHERE STATE ="massachusetts"')
dfRetention.FL <- sqldf('SELECT YEAR, DROP_OUT_8_12, HS_DROP_OUT 
                  FROM dfRetention WHERE STATE ="florida"')
dfRetention.NYMAFL <- sqldf('SELECT UPPER(STATE) STATE, YEAR, TOTAL_EXPENDITURE, 
                  ALL_STUDENT_ALL,DROP_OUT_8_12, HS_DROP_OUT 
                  FROM dfRetention WHERE STATE IN ("new york", "massachusetts", "florida")')

```

```{r}
# Create a new dataframe containing the four y variable and the x variable (Date)
dfRetention.NY_YEAR <- melt(dfRetention.NY, id=c("YEAR"))
dfRetention.MA_YEAR <- melt(dfRetention.MA, id=c("YEAR"))
dfRetention.FL_YEAR <- melt(dfRetention.FL, id=c("YEAR"))
dfRetention.NYMAFL_YEAR <- melt(dfRetention.NYMAFL, id=c("YEAR"))
```

```{r}
# Create retention charts for 8th-12th and high school dropout for NY
nyHS_DROP_OUT_BR <- ggplot(data=dfRetention.NY, aes(x=YEAR, y=HS_DROP_OUT)) +
                geom_bar(stat="identity", color="white", fill="lightblue") +
                xlab(paste(toupper(dfRetention.NY$STATE))) +
                ylab("NY: Total Student") +
                ggtitle("High School Dropout")

nyDROP_OUT_8_12_BR <- ggplot(data=dfRetention.NY, aes(x=YEAR, y=DROP_OUT_8_12)) +
                geom_bar(stat="identity", color="white", fill="lightblue") +
                xlab(paste(toupper(dfRetention.NY$STATE))) +
                ylab("NY: Total Student") +
                ggtitle("8th-12th Grade Dropout")

# Create retention charts for 8th-12th and high school dropout for MA
maHS_DROP_OUT_BR <- ggplot(data=dfRetention.MA, aes(x=YEAR, y=HS_DROP_OUT)) +
                geom_bar(stat="identity", color="white", fill="darkblue") +
                xlab(paste(toupper(dfRetention.MA$STATE))) +
                ylab("MA: Total Student") 

maDROP_OUT_8_12_BR <- ggplot(data=dfRetention.MA, aes(x=YEAR, y=DROP_OUT_8_12)) +
                geom_bar(stat="identity", color="white", fill="darkblue") +
                xlab(paste(toupper(dfRetention.MA$STATE))) +
                ylab("MA: Total Student")

# Create retention charts for 8th-12th and high school dropout for FL
flHS_DROP_OUT_BR <- ggplot(data=dfRetention.FL, aes(x=YEAR, y=HS_DROP_OUT)) +
                geom_bar(stat="identity", color="white", fill="blue") +
                xlab(paste(toupper(dfRetention.FL$STATE))) +
                ylab("FL: Total Student")

flDROP_OUT_8_12_BR <- ggplot(data=dfRetention.FL, aes(x=YEAR, y=DROP_OUT_8_12)) +
                geom_bar(stat="identity", color="white", fill="blue") +
                xlab(paste(toupper(dfRetention.FL$STATE))) +
                ylab("FL: Total Student") 

```

```{r}
# Create retention charts for 8th-12th and high school dropout for NY
nyALL_STUDENT_BR <- ggplot(data=dfRetention.NY, aes(x=YEAR, y=ALL_STUDENT_ALL)) +
                geom_bar(stat="identity", color="white", fill="lightblue") +
                xlab(paste(toupper(dfRetention.NY$STATE))) +
                ylab("NY: Total Student") +
                ggtitle("High School Dropout")

# Create retention charts for 8th-12th and high school dropout for MA
maALL_STUDENT_BR <- ggplot(data=dfRetention.MA, aes(x=YEAR, y=ALL_STUDENT_ALL)) +
                geom_bar(stat="identity", color="white", fill="darkblue") +
                xlab(paste(toupper(dfRetention.MA$STATE))) +
                ylab("MA: Total Student") 

# Create retention charts for 8th-12th and high school dropout for FL
flALL_STUDENT_BR <- ggplot(data=dfRetention.FL, aes(x=YEAR, y=ALL_STUDENT_ALL)) +
                geom_bar(stat="identity", color="white", fill="blue") +
                xlab(paste(toupper(dfRetention.FL$STATE))) +
                ylab("FL: Total Student")

```

```{r}
# Create chart for dropout by state
nyDROP_OUT_SS <- ggplot(dfRetention.NYMAFL,aes(x=YEAR, y=DROP_OUT_8_12)) + 
               geom_point(aes(size=HS_DROP_OUT, color=STATE)) +
               labs(y="8th-12th Grade", size="High School", color="State") +
               ggtitle("Dropout by State")

```

```{r}
# Create chart to show total expenditure for NY
NY_TOT_EXPEND_BP <- ggplot(dfGrades_8NewYork, aes(x=factor(0), dfGrades_8NewYork$TOTAL_EXPENDITURE)) +
                  geom_boxplot()+coord_flip() +
                  labs(x="NEW YORK") +
                  labs(y="Total") +
                  ggtitle("Total Expenditure")

# Create chart to show instruction expenditure for NY
NY_TOT_INST_BP <- ggplot(dfGrades_8NewYork, aes(x=factor(0), dfGrades_8NewYork$INSTRUCTION_EXPENDITURE)) +
                  geom_boxplot()+coord_flip() +
                  labs(x="NEW YORK") +
                  labs(y="Total") +
                  ggtitle("Instruction Expenditure")

# Create chart to show total 8th-12th dropout for NY
NY_HS_DROP_OUT_BP <- ggplot(dfGrades_8NewYork, aes(x=factor(0), dfGrades_8NewYork$HS_DROP_OUT)) +
                  geom_boxplot()+coord_flip() +
                  labs(x="NEW YORK") +
                  labs(y="Total") +
                  ggtitle("8th-12th Dropout")

# Create chart to show high school dropout for NY
NY_DROP_OUT_8_12_BP <- ggplot(dfGrades_8NewYork, aes(x=factor(0), dfGrades_8NewYork$DROP_OUT_8_12)) +
                  geom_boxplot()+coord_flip() +
                  labs(x="NEW YORK") +
                  labs(y="Total") +
                  ggtitle("High School Dropout")

# Create chart to show total score for NY
NY_SCORE_BP <- ggplot(dfGrades_8NewYork, aes(x=factor(0), dfGrades_8NewYork$SCORE)) +
                  geom_boxplot()+coord_flip() +
                  labs(x="NEW YORK") +
                  labs(y="Total") +
                  ggtitle("score")
```

```{r}
# Combining the charts via grid.arrange
grid.arrange(NY_TOT_EXPEND_BP,NY_TOT_INST_BP)
```

```{r}
# Combining the charts via grid.arrange
grid.arrange(NY_HS_DROP_OUT_BP, NY_DROP_OUT_8_12_BP, NY_SCORE_BP,NY_TOT_INST_BP)
```

```{r}
# Create chart to show total expenditure for MA
MA_TOT_EXPEND_BP <- ggplot(dfGrades_8Massachusetts, aes(x=factor(0), dfGrades_8Massachusetts$TOTAL_EXPENDITURE)) +
                  geom_boxplot()+coord_flip() +
                  labs(x="MASSACHUSETTS") +
                  labs(y="Total") +
                  ggtitle("Total Expenditure")

# Create chart to show instruction expenditure for MA
MA_TOT_INST_BP <- ggplot(dfGrades_8Massachusetts, aes(x=factor(0), dfGrades_8Massachusetts$INSTRUCTION_EXPENDITURE)) +
                  geom_boxplot()+coord_flip() +
                  labs(x="MASSACHUSETTS") +
                  labs(y="Total")  +
                  ggtitle("Instruction Expenditure")

# Create chart to show total 8th-12th dropout for MA
MA_HS_DROP_OUT_BP <- ggplot(dfGrades_8Massachusetts, aes(x=factor(0), dfGrades_8Massachusetts$HS_DROP_OUT)) +
                  geom_boxplot()+coord_flip() +
                  labs(x="MASSACHUSETTS") +
                  labs(y="Total") +
                  ggtitle("8th-12th Dropout")

# Create chart to show high school dropout for MA
MA_DROP_OUT_8_12_BP <- ggplot(dfGrades_8Massachusetts, aes(x=factor(0), dfGrades_8Massachusetts$DROP_OUT_8_12)) +
                  geom_boxplot()+coord_flip() +
                  labs(x="MASSACHUSETTS") +
                  labs(y="Total") +
                  ggtitle("High School Dropout")

# Create chart to show total score for MA
MA_SCORE_BP <- ggplot(dfGrades_8Massachusetts, aes(x=factor(0), dfGrades_8Massachusetts$SCORE)) +
                  geom_boxplot()+coord_flip() +
                  labs(x="MASSACHUSETTS") +
                  labs(y="Total") +
                  ggtitle("score")
```

```{r}
# Combining the charts via grid.arrange
grid.arrange(MA_TOT_EXPEND_BP,MA_TOT_INST_BP)
```

```{r}
# Combining the charts via grid.arrange
grid.arrange(MA_HS_DROP_OUT_BP, MA_DROP_OUT_8_12_BP, MA_SCORE_BP,MA_TOT_INST_BP)
```

```{r}
# Create chart to show total expenditure for FL
FL_TOT_EXPEND_BP <- ggplot(dfGrades_8Florida, aes(x=factor(0), dfGrades_8Florida$TOTAL_EXPENDITURE)) +
                  geom_boxplot()+coord_flip() +
                  labs(x="FLORIDA") +
                  labs(y="Total") +
                  ggtitle("Total Expenditure")

# Create chart to show instruction expenditure for FL
FL_TOT_INST_BP <- ggplot(dfGrades_8Florida, aes(x=factor(0), dfGrades_8Florida$INSTRUCTION_EXPENDITURE)) +
                  geom_boxplot()+coord_flip() +
                  labs(x="FLORIDA") +
                  labs(y="Total")  +
                  ggtitle("Instruction Expenditure")

# Create chart to show total 8th-12th dropout for FL
FL_HS_DROP_OUT_BP <- ggplot(dfGrades_8Florida, aes(x=factor(0), dfGrades_8Florida$HS_DROP_OUT)) +
                  geom_boxplot()+coord_flip() +
                  labs(x="FLORIDA") +
                  labs(y="Total") +
                  ggtitle("8th-12th Dropout")

# Create chart to show high school dropout for FL
FL_DROP_OUT_8_12_BP <- ggplot(dfGrades_8Florida, aes(x=factor(0), dfGrades_8Florida$DROP_OUT_8_12)) +
                  geom_boxplot()+coord_flip() +
                  labs(x="FLORIDA") +
                  labs(y="Total") +
                  ggtitle("High School Dropout")

# Create chart to show total score for FL
FL_SCORE_BP <- ggplot(dfGrades_8Florida, aes(x=factor(0), dfGrades_8Florida$SCORE)) +
                  geom_boxplot()+coord_flip() +
                  labs(x="FLORIDA") +
                  labs(y="Total") +
                  ggtitle("score")
```

```{r}
# Combining the charts via grid.arrange
grid.arrange(FL_TOT_EXPEND_BP,FL_TOT_INST_BP)
```

```{r}
# Combining the charts via grid.arrange
grid.arrange(FL_HS_DROP_OUT_BP, FL_DROP_OUT_8_12_BP, FL_SCORE_BP, FL_TOT_INST_BP)
```
```{r}
grid.arrange(nyDROP_OUT_SS)
```

```{r}
# Create a histogram showing retention for each state
par(bg="grey90")
par(mar=c(0,0,0,0))
dfRetention.NY_YEAR=rnorm(400 , mean=-3 , sd=12)
dfRetention.MA_YEAR=rnorm(400 , mean=20 , sd=3)
dfRetention.FL_YEAR=rnorm(400 , mean=-20 , sd=3)
hist(dfRetention.NY_YEAR, col=rgb(1,0.2,0.2,0.7) , breaks=50 , xlim=c(-40 , 40) , main="" , ylim=c(-20 , 70) )
hist(dfRetention.MA_YEAR, col=rgb(0,1,0.5,1) , breaks=15 , add=T)
hist(dfRetention.FL_YEAR, col=rgb(0.6,0.4,1,1) , breaks=15 , add=T)

```

```{r}

grid.arrange(nyDROP_OUT_8_12_BR, nyHS_DROP_OUT_BR, maDROP_OUT_8_12_BR, maHS_DROP_OUT_BR, flDROP_OUT_8_12_BR, flHS_DROP_OUT_BR, ncol=2)
```
```{r}
grid.arrange( 
        ggplot(dfRetention.NY, aes(x = YEAR, y = DROP_OUT_8_12)) +
        geom_point() +
        stat_smooth(method = "lm", col = "darkblue") +
        labs(x="Year") +
        labs(y="New York") +
        ggtitle("8TH-12TH Dropout by Year"),
        
        ggplot(dfRetention.NY, aes(x = YEAR, y = HS_DROP_OUT)) +
        geom_point() +
        stat_smooth(method = "lm", col = "darkblue") +
        labs(x="Year") +
        labs(y="New York") +
        ggtitle("High School Dropout by Year"),
        
        ggplot(dfGrades_8NewYork, aes(x = YEAR, y = SCORE)) +
        geom_point() +
        stat_smooth(method = "lm", col = "darkblue") +
        labs(x="Year") +
        labs(y="New York") +
        ggtitle("Score by Year"),
        
        ggplot(dfGrades_8NewYork, aes(x = YEAR, y = INSTRUCTION_EXPENDITURE)) +
        geom_point() +
        stat_smooth(method = "lm", col = "darkblue") +
        labs(x="Year") +
        labs(y="New York") +
        ggtitle("Instruction Expenditure")
)
```
```{r}
grid.arrange( 
        ggplot(dfRetention.MA, aes(x = YEAR, y = DROP_OUT_8_12)) +
        geom_point() +
        stat_smooth(method = "lm", col = "white") +
        labs(x="Year") +
        labs(y="Massachusetts") +
        ggtitle("8TH-12TH Dropout by Year"),
        
        ggplot(dfRetention.MA, aes(x = YEAR, y = HS_DROP_OUT)) +
        geom_point() +
        stat_smooth(method = "lm", col = "white") +
        labs(x="Year") +
        labs(y="Massachusetts") +
        ggtitle("High School Dropout by Year"),
        
        ggplot(dfGrades_8Massachusetts, aes(x = YEAR, y = SCORE)) +
        geom_point() +
        stat_smooth(method = "lm", col = "white") +
        labs(x="Year") +
        labs(y="Massachusetts") +
        ggtitle("Score by Year"),
        
        ggplot(dfGrades_8Massachusetts, aes(x = YEAR, y = INSTRUCTION_EXPENDITURE)) +
        geom_point() +
        stat_smooth(method = "lm", col = "white") +
        labs(x="Year") +
        labs(y="Massachusetts") +
        ggtitle("Instruction Expenditure")
)
```

```{r}
grid.arrange( 
        ggplot(dfRetention.FL, aes(x = YEAR, y = DROP_OUT_8_12)) +
        geom_point() +
        stat_smooth(method = "lm", col = "blue") +
        labs(x="Year") +
        labs(y="Florida") +
        ggtitle("8TH-12TH Dropout by Year"),
        
        ggplot(dfRetention.FL, aes(x = YEAR, y = HS_DROP_OUT)) +
        geom_point() +
        stat_smooth(method = "lm", col = "blue") +
        labs(x="Year") +
        labs(y="Florida") +
        ggtitle("High School Dropout by Year"),
        
        ggplot(dfGrades_8Florida, aes(x = YEAR, y = SCORE)) +
        geom_point() +
        stat_smooth(method = "lm", col = "blue") +
        labs(x="Year") +
        labs(y="Florida") +
        ggtitle("Score by Year"),
        
        ggplot(dfGrades_8Florida, aes(x = YEAR, y = INSTRUCTION_EXPENDITURE)) +
        geom_point() +
        stat_smooth(method = "lm", col = "blue") +
        labs(x="Year") +
        labs(y="Florida") +
        ggtitle("Instruction Expenditure")
)
```
```{r}

# Creating data 

dfRetention.NY_YEAR =c(rnorm(1000 , 0 , 2) , rnorm(1000 , 9 , 2))
 
# Layout to split the screen
layout(mat = matrix(c(1,2),2,1, byrow=TRUE),  height = c(1,8))
 
# Draw the boxplot and the histogram 
par(mar=c(0, 3.1, 1.1, 2.1))
boxplot(dfRetention.NY_YEAR , horizontal=TRUE , ylim=c(-10,20), xaxt="n" , frame=F)
par(mar=c(4, 3.1, 1.1, 2.1))
hist(dfRetention.NY_YEAR, breaks=40 , col="darkblue" , border=F , main="" , xlab="Retention NY", xlim=c(-10,20))

# Creating data 
dfRetention.MA_YEAR=c(rnorm(1000 , 0 , 2) , rnorm(1000 , 9 , 2))
 
# Layout to split the screen
layout(mat = matrix(c(1,2),2,1, byrow=TRUE),  height = c(1,8))
 
# Draw the boxplot and the histogram 
par(mar=c(0, 3.1, 1.1, 2.1))
boxplot(dfRetention.MA_YEAR , horizontal=TRUE , ylim=c(-10,20), xaxt="n" ,  frame=F)
par(mar=c(4, 3.1, 1.1, 2.1))
hist(dfRetention.MA_YEAR, breaks=40 , col="darkred" , border=F , main="" , xlab="Retention MA", xlim=c(-10,20))

# Creating data 
dfRetention.FL_YEAR =c(rnorm(1000 , 0 , 2) , rnorm(1000 , 9 , 2))
 
# Layout to split the screen
layout(mat = matrix(c(1,2),2,1, byrow=TRUE),  height = c(1,8))
 
# Draw the boxplot and the histogram 
par(mar=c(0, 3.1, 1.1, 2.1))
boxplot(dfRetention.FL_YEAR , horizontal=TRUE , ylim=c(-10,20), xaxt="n" ,  frame=F)
par(mar=c(4, 3.1, 1.1, 2.1))
hist(dfRetention.FL_YEAR, breaks=40 , col=rgb(0.2,0.8,0.5,0.5) , border=F , main="" , xlab="Retention FL", xlim=c(-10,20))

```

# 5 Modeling Techniques

```{r}
# Finding Retention for NY, MA and FL
dfRetention_NY <- sqldf('SELECT * FROM dfRetention 
                        WHERE STATE IN ("new york")')
dfRetention_MA <- sqldf('SELECT * FROM dfRetention 
                        WHERE STATE IN ("massachusetts")')
dfRetention_FL <- sqldf('SELECT * FROM dfRetention 
                        WHERE STATE IN ("florida")')
```

## 5.1  Generalized Linear Regression


```{r}
# Models for Retention NY
NY_mHS_DROP_OUT_EXPENDLM <- lm(HS_DROP_OUT ~ INSTRUCTION_EXPENDITURE, data=dfRetention_NY)

NY_mHS_DROP_OUT_ScoreLM <- lm(HS_DROP_OUT ~ AVG_MATH_8_SCORE + AVG_READING_8_SCORE, 
                              data=dfRetention_NY)

NY_mDROP_OUT_8_12_ScoreLM <- lm(DROP_OUT_8_12 ~  AVG_MATH_8_SCORE + AVG_READING_8_SCORE, 
                                data=dfRetention_NY)

```

```{r, include=TRUE}
# Display model summaries
summary(NY_mHS_DROP_OUT_EXPENDLM)
summary(NY_mHS_DROP_OUT_ScoreLM)
summary(NY_mDROP_OUT_8_12_ScoreLM)
```

```{r}
# Models for Retention MA
MA_mHS_DROP_OUT_EXPENDLM <- lm(HS_DROP_OUT ~ INSTRUCTION_EXPENDITURE, 
                               data=dfRetention_MA)

MA_mHS_DROP_OUT_ScoreLM <- lm(HS_DROP_OUT ~ AVG_MATH_8_SCORE + AVG_READING_8_SCORE, 
                              data=dfRetention_MA)

MA_mDROP_OUT_8_12_ScoreLM <- lm(DROP_OUT_8_12 ~  AVG_MATH_8_SCORE + AVG_READING_8_SCORE, 
                                data=dfRetention_MA)

```

```{r, include=TRUE}
# DisplAy model summaries
summary(MA_mHS_DROP_OUT_EXPENDLM)
summary(MA_mHS_DROP_OUT_ScoreLM)
summary(MA_mDROP_OUT_8_12_ScoreLM)
```

```{r}
# Models for Retention FL
FL_mHS_DROP_OUT_EXPENDLM <- lm(HS_DROP_OUT ~ INSTRUCTION_EXPENDITURE, 
                               data=dfRetention_FL)

FL_mHS_DROP_OUT_ScoreLM <- lm(HS_DROP_OUT ~ AVG_MATH_8_SCORE + AVG_READING_8_SCORE, 
                              data=dfRetention_FL)

FL_mDROP_OUT_8_12_ScoreLM <- lm(DROP_OUT_8_12 ~  AVG_MATH_8_SCORE + AVG_READING_8_SCORE, 
                                data=dfRetention_FL)


```

```{r, include=TRUE}
# Display model summaries
summary(FL_mHS_DROP_OUT_EXPENDLM)
summary(FL_mHS_DROP_OUT_ScoreLM)
summary(FL_mDROP_OUT_8_12_ScoreLM)
```

```{r, include=TRUE}
# Test model
NY_pmHS_DROP_OUT_EXPENDLM <- predict(NY_mHS_DROP_OUT_ScoreLM, 
                                    dfRetention_NY, type='response')
NY_pmHS_DROP_OUT_ScoreLM <- predict(NY_mHS_DROP_OUT_ScoreLM, 
                                    dfRetention_NY, type='response')
NY_pmDROP_OUT_8_12_ScoreLM <-  predict(NY_mDROP_OUT_8_12_ScoreLM, 
                                       dfRetention_NY, type='response')
```

```{r}
# Print results
NY_pmHS_DROP_OUT_EXPENDLM
NY_pmHS_DROP_OUT_ScoreLM
NY_pmDROP_OUT_8_12_ScoreLM
```

```{r, include=TRUE}
# Test model
MA_pmHS_DROP_OUT_EXPENDLM <- predict(MA_mHS_DROP_OUT_ScoreLM, 
                                    dfRetention_NY, type='response')
MA_pmHS_DROP_OUT_ScoreLM <- predict(MA_mHS_DROP_OUT_ScoreLM, 
                                    dfRetention_NY, type='response')
MA_pmDROP_OUT_8_12_ScoreLM <-  predict(MA_mDROP_OUT_8_12_ScoreLM, 
                                       dfRetention_NY, type='response')
```

```{r}
# Print results
MA_pmHS_DROP_OUT_EXPENDLM
MA_pmHS_DROP_OUT_ScoreLM
MA_pmDROP_OUT_8_12_ScoreLM
```

```{r, include=TRUE}
# Test model
FL_pmHS_DROP_OUT_EXPENDLM <- predict(FL_mHS_DROP_OUT_ScoreLM, 
                                    dfRetention_NY, type='response')
FL_pmHS_DROP_OUT_ScoreLM <- predict(FL_mHS_DROP_OUT_ScoreLM, 
                                    dfRetention_NY, type='response')
FL_pmDROP_OUT_8_12_ScoreLM <-  predict(FL_mDROP_OUT_8_12_ScoreLM, 
                                   dfRetention_NY, type='response')
```

```{r}
# Print results
FL_pmHS_DROP_OUT_EXPENDLM
FL_pmHS_DROP_OUT_ScoreLM
FL_pmDROP_OUT_8_12_ScoreLM
```

```{r}
# Linear modeling Scores vs. Expenditure for 8th Graders
NY_mGRADES_8_EXPENDLM <- lm(formula = AVG_MATH_8_SCORE + AVG_READING_8_SCORE ~ 
                              INSTRUCTION_EXPENDITURE, data=dfRetention_NY)
MA_mGRADES_8_EXPENDLM <- lm(formula = AVG_MATH_8_SCORE + AVG_READING_8_SCORE ~ 
                              INSTRUCTION_EXPENDITURE, data=dfRetention_MA)
FL_mGRADES_8_EXPENDLM <- lm(formula = AVG_MATH_8_SCORE + AVG_READING_8_SCORE ~ 
                              INSTRUCTION_EXPENDITURE, data=dfRetention_FL)

```

```{r}
summary(NY_mGRADES_8_EXPENDLM )
summary(MA_mGRADES_8_EXPENDLM )
summary(FL_mGRADES_8_EXPENDLM )
```

```{r}
# Testing models
pNY_mGRADES_8_EXPENDLM <- predict(NY_mGRADES_8_EXPENDLM, 
                                  dfGrades_8NewYork, type='response')
pMA_mGRADES_8_EXPENDLM <- predict(MA_mGRADES_8_EXPENDLM, 
                                  dfGrades_8Massachusetts, type='response')
pFL_mGRADES_8_EXPENDLM <- predict(FL_mGRADES_8_EXPENDLM, 
                                  dfGrades_8Florida, type='response')
```
```{r}
# Print results
pNY_mGRADES_8_EXPENDLM 
pMA_mGRADES_8_EXPENDLM 
pFL_mGRADES_8_EXPENDLM 
```


## 5.2 Support Vector Machines (SVM)
```{r}
# These datasets are from the original file with no filter
dfRetention_NY_ALL <- sqldf('SELECT * FROM dfRetention_ALL 
                            WHERE STATE IN ("new york")')
dfRetention_MA_ALL <- sqldf('SELECT * FROM dfRetention_ALL 
                            WHERE STATE IN ("massachusetts")')
dfRetention_FL_ALL <- sqldf('SELECT * FROM dfRetention_ALL 
                            WHERE STATE IN ("florida")')
```

```{r}
# Create test and train dataset for Retention
NY_randIndex <- sample(1:dim(dfRetention_NY_ALL)[1])
NY_cutPoint2_3 <- floor(2 * dim(dfRetention_NY_ALL)[1]/3)

NY_tr.Retention <- dfRetention_NY_ALL[NY_randIndex[1:NY_cutPoint2_3],]
NY_ts.Retention <- dfRetention_NY_ALL[NY_randIndex[(NY_cutPoint2_3 + 1)
                                                   :dim(dfRetention_NY_ALL)[1]],]
```

```{r}
# Create test and train dataset for Retention
MA_randIndex <- sample(1:dim(dfRetention_MA_ALL)[1])
MA_cutPoint2_3 <- floor(2 * dim(dfRetention_MA_ALL)[1]/3)

MA_tr.Retention <- dfRetention_MA_ALL[MA_randIndex[1:MA_cutPoint2_3],]
MA_ts.Retention <- dfRetention_MA_ALL[MA_randIndex[(MA_cutPoint2_3 + 1)
                                                   :dim(dfRetention_MA_ALL)[1]],]
```

```{r}
# Create test and train dataset for Retention
FL_randIndex <- sample(1:dim(dfRetention_FL_ALL)[1])
FL_cutPoint2_3 <- floor(2 * dim(dfRetention_FL_ALL)[1]/3)

FL_tr.Retention <- dfRetention_FL_ALL[FL_randIndex[1:FL_cutPoint2_3],]
FL_ts.Retention <- dfRetention_FL_ALL[FL_randIndex[(FL_cutPoint2_3 + 1)
                                                   :dim(dfRetention_FL_ALL)[1]],]
```

# Models for Retention
```{r}
# Models for Retention NY
NY_mHS_DROP_OUT_EXPEND <- ksvm(HS_DROP_OUT ~ INSTRUCTION_EXPENDITURE,
                          data=NY_tr.Retention, kernel = "rbfdot", 
                          kpar="automatic", C=1, cross=2, prob.model=TRUE)

NY_mHS_DROP_OUT_Score <- ksvm(HS_DROP_OUT ~ AVG_MATH_8_SCORE + AVG_READING_8_SCORE,
                          data=NY_tr.Retention, kernel = "rbfdot",
                          kpar="automatic", C=1, cross=2, prob.model=TRUE)

NY_mDROP_OUT_8_12_Score <- ksvm(DROP_OUT_8_12 ~ AVG_MATH_8_SCORE + AVG_READING_8_SCORE,
                          data=NY_tr.Retention, kernel = "rbfdot",
                          kpar="automatic", C=1, cross=2, prob.model=TRUE)
```

```{r}
# Print results
NY_mHS_DROP_OUT_EXPEND
NY_mHS_DROP_OUT_Score
NY_mDROP_OUT_8_12_Score
```

```{r}
# Models for Retention MA
MA_mHS_DROP_OUT_EXPEND <- ksvm(HS_DROP_OUT ~ INSTRUCTION_EXPENDITURE,
                          data=MA_tr.Retention, kernel = "rbfdot", 
                          kpar="automatic", C=1, cross=2, prob.model=TRUE)

MA_mHS_DROP_OUT_Score <- ksvm(HS_DROP_OUT ~ AVG_MATH_8_SCORE + AVG_READING_8_SCORE,
                          data=MA_tr.Retention, kernel = "rbfdot",
                          kpar="automatic", C=1, cross=2, prob.model=TRUE)

MA_mDROP_OUT_8_12_Score <- ksvm(DROP_OUT_8_12 ~ AVG_MATH_8_SCORE + AVG_READING_8_SCORE,
                          data=MA_tr.Retention, kernel = "rbfdot",
                          kpar="automatic", C=1, cross=2, prob.model=TRUE)
```

```{r}
# Print results
MA_mHS_DROP_OUT_EXPEND
MA_mHS_DROP_OUT_Score
MA_mDROP_OUT_8_12_Score
```

```{r}
# Models for Retention FL
FL_mHS_DROP_OUT_EXPEND <- ksvm(HS_DROP_OUT ~ INSTRUCTION_EXPENDITURE,
                          data=FL_tr.Retention, kernel = "rbfdot", 
                           kpar="automatic", C=1, cross=2, prob.model=TRUE)

FL_mHS_DROP_OUT_Score <- ksvm(HS_DROP_OUT ~ AVG_MATH_8_SCORE + AVG_READING_8_SCORE,
                          data=FL_tr.Retention, kernel = "rbfdot",
                           kpar="automatic", C=1, cross=2, prob.model=TRUE)

FL_mDROP_OUT_8_12_Score <- ksvm(DROP_OUT_8_12 ~ AVG_MATH_8_SCORE + AVG_READING_8_SCORE,
                          data=FL_tr.Retention, kernel = "rbfdot",
                           kpar="automatic", C=1, cross=2, prob.model=TRUE)
```

```{r}
# Print results
FL_mHS_DROP_OUT_EXPEND
FL_mHS_DROP_OUT_Score
FL_mDROP_OUT_8_12_Score
```
## Scores vs. Expenditure for 8th Graders
```{r}
NY_mGRADES_8_EXPEND <- ksvm(AVG_MATH_8_SCORE + AVG_READING_8_SCORE ~ INSTRUCTION_EXPENDITURE,
                          data=NY_tr.Retention, kernel = "rbfdot", 
                          kpar="automatic", C=1, cross=2, prob.model=TRUE)

MA_mGRADES_8_EXPEND <- ksvm(AVG_MATH_8_SCORE + AVG_READING_8_SCORE ~ INSTRUCTION_EXPENDITURE,
                          data=MA_tr.Retention, kernel = "rbfdot", 
                          kpar="automatic", C=1, cross=2, prob.model=TRUE)

FL_mGRADES_8_EXPEND <- ksvm(AVG_MATH_8_SCORE + AVG_READING_8_SCORE ~ INSTRUCTION_EXPENDITURE,
                          data=FL_tr.Retention, kernel = "rbfdot", 
                          kpar="automatic", C=1, cross=2, prob.model=TRUE)

```
```{r}
# Print results
summary(NY_mGRADES_8_EXPEND)
summary(MA_mGRADES_8_EXPEND)
summary(FL_mGRADES_8_EXPEND) 

```

## Predicting retention
```{r}
# creating a function to calculate the error
rmse <- function(error)
{
  return (sqrt(mean(error^2)))
}
```

```{r}
# Model is created on line 946
pNY_mHS_DROP_OUT_EXPEND <- predict(NY_mHS_DROP_OUT_EXPEND, NY_ts.Retention)
pNY_mHS_DROP_OUT_EXPEND.Error <- (NY_ts.Retention$HS_DROP_OUT - pNY_mHS_DROP_OUT_EXPEND )
pNY_mHS_DROP_OUT_EXPEND.rmse <-  rmse(pNY_mHS_DROP_OUT_EXPEND.Error)
print(pNY_mHS_DROP_OUT_EXPEND.rmse)
```
```{r}
# model is created on line 950
pNY_mHS_DROP_OUT_Score  <- predict(NY_mHS_DROP_OUT_Score , NY_ts.Retention)
pNY_mHS_DROP_OUT_Score.Error <- (NY_ts.Retention$HS_DROP_OUT - pNY_mHS_DROP_OUT_Score  )
pNY_mHS_DROP_OUT_Score.rmse <-  rmse(pNY_mHS_DROP_OUT_Score.Error)
print(pNY_mHS_DROP_OUT_Score.rmse)
```
```{r}
# model is created on line 954
pNY_mDROP_OUT_8_12_Score <- predict(NY_mDROP_OUT_8_12_Score, NY_ts.Retention)
pNY_mDROP_OUT_8_12_Score.Error <- (NY_ts.Retention$HS_DROP_OUT - pNY_mDROP_OUT_8_12_Score )
pNY_mDROP_OUT_8_12_Score.rmse <-  rmse(pNY_mDROP_OUT_8_12_Score.Error)
print(pNY_mDROP_OUT_8_12_Score.rmse)
```
```{r}
# model is created on line 968
pMA_mHS_DROP_OUT_EXPEND <- predict(MA_mHS_DROP_OUT_EXPEND, NY_ts.Retention)
pMA_mHS_DROP_OUT_EXPEND.Error <- (NY_ts.Retention$HS_DROP_OUT - pMA_mHS_DROP_OUT_EXPEND )
pMA_mHS_DROP_OUT_EXPEND.rmse <-  rmse(pMA_mHS_DROP_OUT_EXPEND.Error)
print(pMA_mHS_DROP_OUT_EXPEND.rmse)
```
```{r}
# model is created on line 972
pMA_mHS_DROP_OUT_Score <- predict(MA_mHS_DROP_OUT_Score, NY_ts.Retention)
pMA_mHS_DROP_OUT_Score.Error <- (NY_ts.Retention$HS_DROP_OUT - pMA_mHS_DROP_OUT_Score )
pMA_mHS_DROP_OUT_Score.rmse <-  rmse(pMA_mHS_DROP_OUT_Score.Error)
print(pMA_mHS_DROP_OUT_Score.rmse)
```
```{r}
# model is created on line 976
pMA_mDROP_OUT_8_12_Score <- predict(MA_mDROP_OUT_8_12_Score, NY_ts.Retention)
pMA_mDROP_OUT_8_12_Score.Error <- (NY_ts.Retention$HS_DROP_OUT - pMA_mDROP_OUT_8_12_Score )
pMA_mDROP_OUT_8_12_Score.rmse <-  rmse(pMA_mDROP_OUT_8_12_Score.Error)
print(pMA_mDROP_OUT_8_12_Score.rmse)
```
```{r}
# model is created on line 990
pFL_mHS_DROP_OUT_EXPEND <- predict(FL_mHS_DROP_OUT_EXPEND, NY_ts.Retention)
pFL_mHS_DROP_OUT_EXPEND.Error <- (NY_ts.Retention$HS_DROP_OUT - pFL_mHS_DROP_OUT_EXPEND )
pFL_mHS_DROP_OUT_EXPEND.rmse <-  rmse(pFL_mHS_DROP_OUT_EXPEND.Error)
print(pFL_mHS_DROP_OUT_EXPEND.rmse)
```

```{r}
# model is created on line 994
pFL_mHS_DROP_OUT_Score <- predict(FL_mHS_DROP_OUT_Score, NY_ts.Retention)
pFL_mHS_DROP_OUT_Score.Error <- (NY_ts.Retention$HS_DROP_OUT - pFL_mHS_DROP_OUT_Score )
pFL_mHS_DROP_OUT_Score.rmse <-  rmse(pFL_mHS_DROP_OUT_Score.Error)
print(pFL_mHS_DROP_OUT_Score.rmse)
```
```{r}
# model is created on line 998
pFL_mDROP_OUT_8_12_Score <- predict(FL_mDROP_OUT_8_12_Score, NY_ts.Retention)
pFL_mDROP_OUT_8_12_Score.Error <- (NY_ts.Retention$HS_DROP_OUT - pFL_mDROP_OUT_8_12_Score )
pFL_mDROP_OUT_8_12_Score.rmse <-  rmse(pFL_mDROP_OUT_8_12_Score.Error)
print(pFL_mDROP_OUT_8_12_Score.rmse)
```

```{r}
# model is created on line 1011
pNY_mGRADES_8_EXPEND <- predict(NY_mGRADES_8_EXPEND, NY_ts.Retention)
pNY_mGRADES_8_EXPEND.Error <- (NY_ts.Retention$HS_DROP_OUT - pNY_mGRADES_8_EXPEND )
pNY_mGRADES_8_EXPEND.rmse <-  rmse(pNY_mGRADES_8_EXPEND.Error)
print(pNY_mGRADES_8_EXPEND.rmse)
```

```{r}
# model is created on line 1015
pMA_mGRADES_8_EXPEND <- predict(MA_mGRADES_8_EXPEND, NY_ts.Retention)
pMA_mGRADES_8_EXPEND.Error <- (NY_ts.Retention$HS_DROP_OUT - pMA_mGRADES_8_EXPEND )
pMA_mGRADES_8_EXPEND.rmse <-  rmse(pMA_mGRADES_8_EXPEND.Error)
print(pMA_mGRADES_8_EXPEND.rmse)
```

```{r}
# model is created on line 1019
pFL_mGRADES_8_EXPEND <- predict(FL_mGRADES_8_EXPEND, NY_ts.Retention)
pFL_mGRADES_8_EXPEND.Error <- (NY_ts.Retention$HS_DROP_OUT - pFL_mGRADES_8_EXPEND )
pFL_mGRADES_8_EXPEND.rmse <-  rmse(pFL_mGRADES_8_EXPEND.Error)
print(pFL_mGRADES_8_EXPEND.rmse)
```

